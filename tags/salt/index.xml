<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Salt on vBlog</title>
    <link>http://vladvasiliu.com/tags/salt/index.xml</link>
    <description>Recent content in Salt on vBlog</description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>Copyright Â© 2016 Vlad Vasiliu; all rights reserved.</copyright>
    <atom:link href="http://vladvasiliu.com/tags/salt/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Using Python in SaltStack reactor</title>
      <link>http://vladvasiliu.com/post/20161231-1210-Using_python_in_saltstack_reactor/</link>
      <pubDate>Sat, 31 Dec 2016 12:11:00 +0200</pubDate>
      
      <guid>http://vladvasiliu.com/post/20161231-1210-Using_python_in_saltstack_reactor/</guid>
      <description>&lt;p&gt;Sometimes you need to do some complex actions in a Salt Reactor in which case Python comes in handy.&lt;/p&gt;

&lt;p&gt;The documentation is not very clear on how to write Python states. The main point is that Salt expects a structure that can be compiled to a Python dictionary. The run() function has to return a dictionary which resembles the state you would write with YAML.&lt;/p&gt;

&lt;p&gt;Here&amp;rsquo;s an example to add a domain to route 53:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;#!py

def run():
   &#39;&#39;&#39;Add domain name to route53&#39;&#39;&#39;

   full_name = data[&#39;name&#39;]

   subzone, name = full_name.split(&#39;.&#39;)
   zone = &amp;quot;some.zone.tld&amp;quot;

   try:
       aws_query = __salt__[&#39;cloud.full_query&#39;]()[&#39;aws&#39;][&#39;ec2&#39;][full_name][&#39;dnsName&#39;]
   except KeyError:
       dns_setup_hsd = {&#39;setup-dns&#39;:
           {&#39;local.test.nop&#39;: [
               {&#39;tgt&#39;: &#39;some.minion.id&#39;},
               ]}}
   else:
       dns_setup_hsd = {&#39;setup-dns&#39;:
           {&#39;local.boto_route53.add_record&#39;: [
               {&#39;tgt&#39;: &#39;some.minion.id&#39;},
               {&#39;arg&#39;: [
                   &#39;.&#39;.join((name, zone)),
                   aws_query,
                   zone,
                   &#39;CNAME&#39;]}]}}

   return dns_setup_hsd

&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>