<!DOCTYPE html>
<html lang="en">
<head>

  
  <meta charset="utf-8">
  <title>Running Chrome in dual screen kiosk mode on Ubuntu - vBlog</title>
  <meta name="description" content="Running Chrome in dual screen kiosk mode on Ubuntu">
  <meta name="author" content="Vlad Vasiliu">

  
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="http://vladvasiliu.com/css/fonts.css">
  
  
  <link rel="stylesheet" href="https://unpkg.com/purecss@0.6.1/build/pure-min.css" integrity="sha384-CCTZv2q9I9m3UOxRLaJneXrrqKwUNOzZ6NGEUMwHtShDJ+nCoiXJCAgi05KfkLGY" crossorigin="anonymous">
  
  
    <link rel="stylesheet" href="https://unpkg.com/purecss@0.6.1/build/grids-responsive-min.css">
  
  <link rel="stylesheet" href="http://vladvasiliu.com/css/custom.css">

  
  
  <link rel="stylesheet" href="http://vladvasiliu.com/highlight/styles/zenburn.css">
  
  <script src="http://vladvasiliu.com/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <meta name="generator" content="Hugo 0.46" />
  
</head>
<body>

<div class="header pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="desktop pure-menu pure-menu-horizontal nav-menu">
            
            <a href="http://vladvasiliu.com/" class="site-title pure-menu-heading">vBlog</a>
            <ul class="pure-menu-list">
				
                <li class="pure-menu-item">
                    <a href="http://vladvasiliu.com/about/" class="pure-menu-link">About</a>
                </li>
            </ul>
        </div>
        <div class="mobile pure-menu nav-menu">
            <a href="/" class="pure-menu-heading" id="toggle-home">vBlog</a>
            <a href="#" id="toggle-btn">&#9776;</a>
            <ul class="pure-menu-list" id="toggle-content" style="display:none;">
                
				
                <li class="pure-menu-item">
                    <a href="http://vladvasiliu.com/about" class="pure-menu-link">About</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>

<div class="pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
	<div class="pure-u-11-12 pure-u-md-5-8">
        <div class="post">

            <div class="post-title">
                <p class="footnote">
                    <time class="">2018-08-07</time>
		            
                    
                    |
                    
                    
                    tags:<a href="http://vladvasiliu.com/tags/sys">sys</a> <a href="http://vladvasiliu.com/tags/linux">linux</a> <a href="http://vladvasiliu.com/tags/chrome">chrome</a> <a href="http://vladvasiliu.com/tags/kiosk">kiosk</a> 
                    

                    

                    
                </p>
                <h1>Running Chrome in dual screen kiosk mode on Ubuntu</h1>
            </div>

            <div class="post-content">
                

<h1 id="background">Background</h1>

<p>At work we have to large TV screens used for displaying <a href="http://grafana.com">Grafana</a> dashboards. They are both connected to the same PC.</p>

<p>The PC was running Windows so anytime the PC would reboot, we would have to manually conenct to it via VNC and move the browsers around and set them in full screen mode.</p>

<p>As we are in the office only during work hours, the PC would be shut down and restarted everyday.</p>

<p>I&rsquo;ve been looking around, and there&rsquo;s a Windows Kiosk mode, in which it only starts whatever applicatoin you want automatically. This mode, however, doesn&rsquo;t work well with multiple screens.</p>

<p>After digging around a bit, I figured I should be able to set this up with a programmable window manager on Linux, such as i3.</p>

<h1 id="where-we-re-going">Where we&rsquo;re going</h1>

<ul>
<li>The PC boots up alone at a set time (via bios / efi config)</li>
<li>The system logs the default user in automatically</li>
<li>The system starts up two browser windows, each full screen on its own screen and goes to the predefined URL</li>
</ul>

<h1 id="assumptions">Assumptions</h1>

<ul>
<li>Distribution: Ubuntu Server 18.04</li>
<li>Window manager: i3</li>
<li>Browser: chromium</li>
<li>VNC: x11vnc</li>
<li>Shell : Bash</li>
<li>User: display</li>
<li>Display outputs: DP-1 and DP-2 (find yours with <code>xrandr</code>)</li>
</ul>

<h1 id="installation">Installation</h1>

<p>Get your linux distro, create an install media and install it.</p>

<h1 id="ubuntu-specific-pre-configuration">Ubuntu specific pre-configuration</h1>

<p>For Ubuntu server, there is some configuration to be done:</p>

<ul>
<li>Add <code>universe</code> repository in <code>/etc/apt/sources.list</code>:</li>
</ul>

<pre><code class="language-text">deb http://archive.ubuntu.com/ubuntu bionic main universe
deb http://archive.ubuntu.com/ubuntu bionic-security main universe
deb http://archive.ubuntu.com/ubuntu bionic-updates main universe
</code></pre>

<ul>
<li>Add i3 repositories (<a href="https://i3wm.org/docs/repositories.html">see doc here</a>) :</li>
</ul>

<pre><code>/usr/lib/apt/apt-helper download-file http://debian.sur5r.net/i3/pool/main/s/sur5r-keyring/sur5r-keyring_2018.01.30_all.deb keyring.deb SHA256:baa43dbbd7232ea2b5444cae238d53bebb9d34601cc000e82f11111b1889078a
sudo dpkg -i ./keyring.deb
sudo echo &quot;deb http://debian.sur5r.net/i3/ $(grep '^DISTRIB_CODENAME=' /etc/lsb-release | cut -f2 -d=) universe&quot; &gt;&gt; /etc/apt/sources.list.d/sur5r-i3.list
</code></pre>

<h1 id="packages">Packages</h1>

<pre><code>sudo apt-get update
sudo apt-get install xinit i3-wm chromium-browser unclutter
</code></pre>

<h1 id="automatic-login">Automatic Login</h1>

<p>No Display Manager will be used. It&rsquo;s not particularly useful and this allows a very lightweight install.</p>

<p>Automatic login will be done on TTY1.</p>

<p>Create an override for systemd TTY1 service by editting <code>/etc/systemd/system/getty@tty1.service.d/override.conf</code></p>

<pre><code>[Service]
ExecStart=
ExecStart=-/sbin/agetty --autologin display --noclear %I $TERM
</code></pre>

<p>To test automatic login, make sure you&rsquo;re connected to a different TTY and run</p>

<pre><code>sudo systemctl daemon-reload
sudo systemctl restart getty@tty1.service
</code></pre>

<p>TTY1 should be logged in to <em>display</em> user.</p>

<h1 id="vnc-configuration">VNC configuration</h1>

<p>Set up a password for vnc connection. Read up the man, there are some useful options. I only present the most basic useful ones here.</p>

<pre><code>x11vnc -storepasswd &quot;t0p53cr37&quot; ~/.vnc_passwd
</code></pre>

<p>I prefer running separate instances of Chrome, so I&rsquo;ll create their directories.</p>

<pre><code>mkdir ~/browser1
mkdir ~/browser2
</code></pre>

<h1 id="x-configuration">X configuration</h1>

<p>We&rsquo;ll start X automatically upon login, so edit <code>~/.profile</code></p>

<pre><code>[...]
 
if [[ ! $DISPLAY &amp;&amp; $XDG_VTNR -eq 1 ]]; then
  exec startx
fi
</code></pre>

<p>Tell X to start i3 and x11vnc by creating <code>.xinitrc</code> as follows</p>

<pre><code>xset s off
xset -dpms

# start VNC server
exec x11vnc -find -forever -rfbauth ~/.vnc_passwd&amp;

# start window-manager
i3
</code></pre>

<p>Configure i3 to show each browser on its own display. We do this by attributing each browser a class in <code>~/.config/i3/config</code></p>

<pre><code>[...]

# Comment out if i3bar is not installed (useless, it will be covered by Chrome)
# bar {
#        status_command i3status
# }

# Setting workspace to monitors
workspace 1 output DP-1
workspace 2 output DP-2

# tie each browser to each monitor
for_window [class=&quot;^chromium-left$&quot;] move workspace number 1
for_window [class=&quot;^chromium-right$&quot;] move workspace number 2

exec ~/start-browsers.sh
</code></pre>

<p>Define a script to launch the two browsers in <code>~/start-browsers.sh</code> (don&rsquo;t forget to <code>chmod +x</code> it)</p>

<pre><code>#!/bin/bash

left_url=&quot;https://your.monitor.url.com/dashboard-1&quot;
right_url=&quot;https://https://your.monitor.url.com/dashboard-2&quot;

tmpdir1=~/browser1
tmpdir2=~/browser2

left_target=&quot;chromium-browser --new-window $left_url \
--user-data-dir=$tmpdir1 \
--class=chromium-left \
--no-first-run \
--disable-restore-session-state \
--no-default-browser-check \
--disable-java \
--disable-translate \
--disable-infobars \
--disable-suggestions-service \
--disable-save-password-bubble \
--start-fullscreen&quot;
right_target=&quot;chromium-browser --new-window $right_url \
--disable-java --user-data-dir=$tmpdir2 \
--class=chromium-right \
--no-first-run \
--disable-restore-session-state \
--no-default-browser-check \
--disable-translate \
--disable-infobars \
--disable-suggestions-service \
--disable-save-password-bubble \
--start-fullscreen&quot;

# start app for left screen
i3-msg 'workspace 1'
$left_target &amp;

# start app for right screen
i3-msg 'workspace 2'
$right_target &amp;

# hide mouse pointer
unclutter &amp;
</code></pre>

<h1 id="set-up-automatic-shutdown-via-cron">Set up automatic shutdown via cron</h1>

<p>Run <code>sudo crontab -e</code> and add the folowing line for shutdown at 19:00. Don&rsquo;t forget to configure your BIOS / EFI to start the PC in the morning.</p>

<pre><code>0   19  *   *   *     /sbin/halt -p
</code></pre>

<h1 id="references">References</h1>

<ul>
<li><a href="https://unix.stackexchange.com/questions/364649/i3wm-two-monitors-one-browser-per-monitor-dual-head-kiosk">Stack Overflow question which inspired this</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Getty#Automatic_login_to_virtual_console">Arch Linux documentation on automatic login</a></li>
</ul>

            </div>
        </div>
	</div>
    <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>

<div class="footer pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="footer-content">
		  <div class="pure-menu pure-menu-horizontal">
              <ul>
			      
                  <li class="pure-menu-heading" id="foot-name">Vlad Vasiliu:</li>
                  
				  
                  
          
                  
                  <li class="pure-menu-item">
                      <a href="https://github.com/vladvasiliu" class="pure-menu-link">GitHub</a>
                  </li>
                  
          
                  
                  <li class="pure-menu-item">
                      <a href="https://www.linkedin.com/in/vlad-vasiliu-460b2b18" class="pure-menu-link">LinkedIn</a>
                  </li>
                  
          
                  
          
                  
                  <li class="pure-menu-item">
                      <a href="https://twitter.com/vvasiliu" class="pure-menu-link">Twitter</a>
                  </li>
                  
          
              </ul>
              <a href="#" class="pure-menu-heading pull-right" id="gototop-btn">↑↑</a>
          </div>
		  
		  <p id="foot-copyright">Copyright © 2018 Vlad Vasiliu; all rights reserved.</p>
		  
		</div>
	  </div>
      <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>


<script src="http://vladvasiliu.com/js/jquery.min.js" type="text/javascript"></script>
<script src="http://vladvasiliu.com/js/jquery.timeago.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function(){
    $("time.timeago").timeago();
  })
  $("#toggle-btn").click(function(){
    $("#toggle-content").toggle();
    if($(this).html() === "☰") {
        $(this).html("X")
    } else {
        $(this).html("☰")
    }
  });
  $(window).resize(function(){
    if(window.innerWidth > 768) {
      $(".desktop").removeAttr("style");
    }
  });
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-37751901-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>

